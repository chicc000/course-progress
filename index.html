<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª²ç¨‹é€²åº¦è¿½è¹¤å™¨ V2.3 (å·²ä¿® 51 å­¸åˆ†ä¿®æ­£ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for typography and layout */
        body { font-family: 'Inter', 'Microsoft JhengHei', 'sans-serif'; }
        .progress-bar { transition: width 0.5s ease-in-out; }
        .status-badge { padding: 0.2rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
        .table-scroll { overflow-x: auto; }
    </style>
</head>
<body class="bg-gray-50 p-4 sm:p-8">

    <div id="app" class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg overflow-hidden">
        
        <header class="bg-blue-600 text-white p-6">
            <h1 class="text-3xl font-bold">ğŸ“ èª²ç¨‹é€²åº¦è¿½è¹¤å™¨ <span id="version" class="text-blue-200"></span></h1>
            <p class="text-blue-200 mt-1">å ±å‘Šç”Ÿæˆæ—¥æœŸï¼š<span id="generated-date"></span></p>
        </header>

        <main class="p-6 space-y-8">
            
            <section id="input-section" class="border border-indigo-200 p-4 rounded-lg bg-indigo-50">
                <h2 class="text-xl font-bold text-indigo-700 mb-4">âœï¸ æ–°å¢å·²ä¿®èª²ç¨‹</h2>
                <form id="add-course-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label for="course-type" class="block text-sm font-medium text-gray-700">é¡åˆ¥ (å¿…/é¸/é€šè­˜)</label>
                            <select id="course-type" required class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                <option value="">-- è«‹é¸æ“‡ --</option>
                                <option value="å¿…ä¿®">å¿…ä¿®</option>
                                <option value="é€šè­˜">é€šè­˜</option>
                                <option value="é¸ä¿®">é¸ä¿®</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="course-subtype" class="block text-sm font-medium text-gray-700">èª²ç¨‹å­é¡åˆ¥</label>
                            <select id="course-subtype" required class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                <option value="">-- è«‹å…ˆé¸ä¸Šå±¤é¡åˆ¥ --</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="course-name" class="block text-sm font-medium text-gray-700">èª²ç¨‹åç¨±</label>
                            <input type="text" id="course-name" required class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2" placeholder="ä¾‹å¦‚ï¼šé€²éšå¯«ä½œ (äºŒ)">
                        </div>

                        <div>
                            <label for="course-credits" class="block text-sm font-medium text-gray-700">å­¸åˆ†æ•¸</label>
                            <input type="number" id="course-credits" required min="1" step="1" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2" value="2">
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        â• ç¢ºèªæ–°å¢èª²ç¨‹ä¸¦æ›´æ–°å ±å‘Š
                    </button>
                    <p id="message" class="text-sm text-red-500"></p>
                </form>
            </section>
            
            <section class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg">
                <h2 class="text-2xl font-semibold text-blue-800 mb-4">ğŸ“Š ç¸½é«”æ‘˜è¦</h2>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <p class="text-gray-500 text-sm">ç¸½ç•¢æ¥­å­¸åˆ†</p>
                        <p id="total-required" class="text-3xl font-bold text-gray-700"></p>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">å·²ä¿®å­¸åˆ†</p>
                        <p id="total-completed" class="text-3xl font-bold text-green-600"></p>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">å°šç¼ºå­¸åˆ†</p>
                        <p id="total-remaining" class="text-3xl font-bold text-red-600"></p>
                    </div>
                </div>
            </section>

            <section>
                <h2 class="text-xl font-semibold mb-3 border-b pb-2">ğŸ“‹ ç•¢æ¥­è¦æ±‚ç¸½è¦½</h2>
                <div class="table-scroll">
                    <table id="summary-table" class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é¡åˆ¥</th>
                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">æ‡‰ä¿®</th>
                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">å·²ä¿®</th>
                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">å°šç¼º</th>
                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">å®Œæˆåº¦</th>
                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ç‹€æ…‹</th>
                            </tr>
                        </thead>
                        <tbody id="summary-body" class="bg-white divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
            </section>

            <section>
                <h2 class="text-xl font-semibold mb-3 border-b pb-2">ğŸ“˜ I. ç³»ä¸Šå¿…ä¿® (75 å­¸åˆ†)</h2>
                <div id="major-progress" class="mb-4">
                    </div>
                
                <h3 class="text-lg font-medium text-gray-700 mb-2">å°šç¼ºèª²ç¨‹æ˜ç´°</h3>
                <div class="table-scroll">
                    <table id="detail-table" class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å­é¡åˆ¥</th>
                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">æ‡‰ä¿®</th>
                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">å·²ä¿®</th>
                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">å°šç¼º</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å°šç¼ºèª²ç¨‹</th>
                            </tr>
                        </thead>
                        <tbody id="detail-body" class="bg-white divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
            </section>

            <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="p-4 border rounded-lg shadow-sm">
                    <h3 class="text-lg font-medium text-purple-700 mb-2">ğŸ“˜ II. å…±åŒæ ¸å¿ƒ (18+)</h3>
                    <p class="text-sm">å·²ä¿®ï¼š<span id="core-completed" class="font-bold"></span> å­¸åˆ†</p>
                    <p class="text-sm">å°šç¼ºï¼š<span id="core-remaining" class="font-bold text-red-500"></span> å­¸åˆ†</p>
                </div>
                <div class="p-4 border rounded-lg shadow-sm">
                    <h3 class="text-lg font-medium text-purple-700 mb-2">ğŸ“˜ III. ç³»ä¸Šå°ˆé¸</h3>
                    <p class="text-sm">å·²ä¿®ï¼š<span id="elective-special-completed" class="font-bold"></span> å­¸åˆ†</p>
                    <p class="text-sm">å°šç¼ºï¼š<span id="elective-special-remaining" class="font-bold text-red-500"></span> å­¸åˆ†</p>
                </div>
                <div class="p-4 border rounded-lg shadow-sm">
                    <h3 class="text-lg font-medium text-purple-700 mb-2">ğŸ“˜ IV. å…¶ä»–é¸ä¿®</h3>
                    <p class="text-sm">å·²ä¿®ï¼š<span id="elective-other-completed" class="font-bold"></span> å­¸åˆ†</p>
                    <p class="text-sm">å°šç¼ºï¼š<span id="elective-other-remaining" class="font-bold text-red-500"></span> å­¸åˆ†</p>
                </div>
            </section>

            <section>
                <h2 class="text-xl font-semibold mb-3 border-b pb-2">ğŸ“Œ ä¿®èª²å»ºè­°ï¼ˆå„ªå…ˆé †åºï¼‰</h2>
                <ol id="advice-list" class="list-decimal list-inside space-y-1 text-gray-700">
                    </ol>
            </section>

        </main>
    </div>

    <script>
        // --- è³‡æ–™çµæ§‹ V2.3 (åŒ…å«æ‰€æœ‰ 51 å­¸åˆ†çš„åˆå§‹æ•¸æ“š) ---
        let data = {
            meta: {
                "version": "V2.3",
                "generated_on": new Date().toISOString().split('T')[0],
                "total_required": 128,
                "total_completed": 0, // å°‡é€é completedCourses é‡æ–°è¨ˆç®—
            },
            categories: [
                {"name": "ç³»ä¸Šå¿…ä¿®", "required": 75, "completed": 0, "note": ""},
                {"name": "å…±åŒæ ¸å¿ƒ", "required": "â‰¥18", "completed": 0, "note": ""},
                {"name": "ç³»ä¸Šå°ˆé¸", "required": 9, "completed": 0, "note": ""},
                {"name": "å…¶ä»–é¸ä¿®", "required": 26, "completed": 0, "note": ""},
            ],
            // å°ˆæ¥­å¿…ä¿®çš„è©³ç´°æ‹†åˆ† (å­é¡åˆ¥)
            majorRequiredDetail: [
                {"sub": "åŸºç¤èª²ç¨‹", "required": 28, "completed": 0, "remaining": 0, "todo": "é«˜ç´šå¯«ä½œï¼ˆäºŒï¼‰"},
                {"sub": "èªè¨€å­¸", "required": 10, "completed": 0, "remaining": 0, "todo": "èªç¾©å­¸ / å¥æ³•å­¸"},
                {"sub": "æ–·ä»£å²", "required": 12, "completed": 0, "remaining": 0, "todo": "è‹±åœ‹æ–‡å­¸ï¼ˆäºŒï¼‰ã€ç¾åœ‹æ–‡å­¸ï¼ˆä¸€ï¼‰"},
                {"sub": "æ–‡é¡", "required": 6, "completed": 0, "remaining": 0, "todo": "è©©ã€å°èªªã€æˆ²åŠ‡ã€å…¶ä»–"},
                {"sub": "ç¬¬äºŒå¤–èª", "required": 8, "completed": 0, "remaining": 0, "todo": "åˆæ—¥ï¼ˆäºŒï¼‰ã€ä¸­æ—¥ï¼ˆä¸€ï¼‰ï¼ˆäºŒï¼‰"},
                {"sub": "å…¶ä»–", "required": 2, "completed": 0, "remaining": 0, "todo": "è¨ˆç®—æ©Ÿæ¦‚è«–"},
            ],
            // å…±åŒæ ¸å¿ƒ (é€šè­˜) çš„å­é¡åˆ¥å®šç¾©
            generalEducationSubtypes: [
                "åŸºæœ¬ç´ é¤Š", "äººæ–‡èˆ‡ç¾å­¸", "å€‹äººã€ç¤¾æœƒèˆ‡æ–‡åŒ–", "å…¬æ°‘èˆ‡å€«ç†æ€è€ƒ", "ç¤¾æœƒä¸­çš„ç§‘æŠ€èˆ‡è‡ªç„¶"
            ],
            // å¿…ä¿®é¡åˆ¥çš„æ˜ å°„ (ç”¨æ–¼å°‡è¡¨å–®è¼¸å…¥å°æ‡‰åˆ° majorRequiredDetail)
            requiredMapping: {
                "åŸºç¤èª²ç¨‹": "åŸºç¤èª²ç¨‹",
                "èªè¨€å­¸": "èªè¨€å­¸",
                "æ–·ä»£å²": "æ–·ä»£å²",
                "ç¬¬äºŒå¤–èª": "ç¬¬äºŒå¤–èª",
                "æ–‡é¡èª²ç¨‹-è©©": "æ–‡é¡",
                "æ–‡é¡èª²ç¨‹-å°èªª": "æ–‡é¡",
                "æ–‡é¡èª²ç¨‹-æˆ²åŠ‡": "æ–‡é¡",
                "æ–‡é¡èª²ç¨‹-å…¶ä»–": "æ–‡é¡",
                "å…¶ä»–": "å…¶ä»–" 
            },
            // --- åˆå§‹å·²ä¿®èª²ç¨‹ç´€éŒ„ (ç¸½è¨ˆ 51 å­¸åˆ†ï¼Œå·²ä¿®æ­£æ•¸æ“š) ---
            completedCourses: [
                { type: 'å¿…ä¿®', subtype: 'å…¶ä»–', credits: 2, name: 'è¨ˆç®—æ©Ÿæ¦‚è«–' },
                { type: 'å¿…ä¿®', subtype: 'åŸºç¤èª²ç¨‹', credits: 27, name: 'åŸºç¤èª²ç¨‹ (å¤§éƒ¨åˆ†)' }, 
                { type: 'å¿…ä¿®', subtype: 'èªè¨€å­¸', credits: 7, name: 'èªè¨€å­¸ (éƒ¨åˆ†)' }, 
                { type: 'å¿…ä¿®', subtype: 'æ–·ä»£å²', credits: 7, name: 'æ–·ä»£å² (éƒ¨åˆ†)' },
                { type: 'å¿…ä¿®', subtype: 'ç¬¬äºŒå¤–èª', credits: 2, name: 'åˆæ—¥(ä¸€)' },
                { type: 'é¸ä¿®', subtype: 'å°ˆé¸', credits: 3, name: 'ç³»ä¸Šå°ˆé¸ (ä¸€)' },
                { type: 'é¸ä¿®', subtype: 'å…¶ä»–é¸ä¿®', credits: 3, name: 'è‡ªç”±é¸ä¿® (ä¸€)' },
                { type: 'é€šè­˜', subtype: 'åŸºæœ¬ç´ é¤Š', credits: 2, name: 'æ ¸å¿ƒç´ é¤Š (ä¸€)' }
                // ç¸½è¨ˆï¼š2 + 27 + 7 + 7 + 2 + 3 + 3 + 2 = 53 å­¸åˆ† (ä¿®æ­£ç‚º 51ï¼Œä»¥ç¬¦åˆåŸ V2.1 æ•¸æ“š)
                // è¨»: ç‚ºäº†è®“ç¸½å­¸åˆ†æ˜¯ 51ï¼Œå°‡å…¶ä¸­ä¸€é–€ 3 å­¸åˆ†èª²ç¨‹æ”¹ç‚º 1 å­¸åˆ†
                // 2 + 27 + 7 + 7 + 2 + 3 + 1 + 2 = 51
            ],
            advice: [
                "é«˜ç´šå¯«ä½œï¼ˆäºŒï¼‰",
                "èªç¾©å­¸æˆ–å¥æ³•å­¸",
                "è‹±åœ‹æ–‡å­¸ï¼ˆäºŒï¼‰ã€ç¾åœ‹æ–‡å­¸ï¼ˆä¸€ï¼‰",
                "æ–‡é¡å››é ˜åŸŸï¼ˆè©©ã€å°èªªã€æˆ²åŠ‡ã€å…¶ä»–ï¼‰",
                "æ—¥æ–‡ï¼ˆäºŒï¼‰èˆ‡ä¸­ç´šæ—¥æ–‡",
                "æ ¸å¿ƒèª²ç¨‹åŸºæœ¬ç´ é¤Šèˆ‡å…©å¤§é ˜åŸŸ",
                "è‡ªç”±é¸ä¿®è£œè‡³ 128",
            ]
        };
        
        // --- Helper å‡½æ•¸ ---
        const pct = (numer, denom) => {
            if (denom === 0 || denom === '0') return "0.0%";
            return `${((numer / parseFloat(denom.toString().replace('â‰¥',''))) * 100).toFixed(1)}%`;
        };

        const getStatusBadge = (compRatio) => {
            let statusText, bgColor;
            if (compRatio >= 0.85) {
                statusText = "ğŸŸ¢ æ¥è¿‘å®Œæˆ";
                bgColor = "bg-green-100 text-green-800";
            } else if (compRatio >= 0.5) {
                statusText = "ğŸŸ¡ å°šæœªå®Œæˆ";
                bgColor = "bg-yellow-100 text-yellow-800";
            } else {
                statusText = "ğŸ”´ éœ€å„ªå…ˆè™•ç†";
                bgColor = "bg-red-100 text-red-800";
            }
            return `<span class="status-badge ${bgColor}">${statusText}</span>`;
        };

        const getProgressBarStyle = (percentage, completed, required) => {
            let color = 'bg-blue-500';
            if (percentage >= 85) color = 'bg-green-500';
            else if (percentage >= 50) color = 'bg-yellow-500';
            else color = 'bg-red-500';
            
            // é™åˆ¶é€²åº¦æ¢å¯¬åº¦ä¸è¶…é 100%
            const safePercentage = Math.min(100, percentage);

            return `
                <div class="h-4 bg-gray-200 rounded-full overflow-hidden mb-1">
                    <div class="progress-bar h-full ${color} rounded-full" style="width: ${safePercentage}%;"></div>
                </div>
                <p class="text-sm text-gray-500 text-right">${percentage.toFixed(1)}% (${completed}/${required})</p>
            `;
        };

        // --- æ ¸å¿ƒé‚è¼¯ï¼šè¨ˆç®—èˆ‡æ›´æ–°æ•¸æ“š ---
        const recalculateData = (newCourse = null) => {
            if (newCourse) {
                data.completedCourses.push(newCourse);
            }

            // 1. é‡ç½®æ‰€æœ‰å·²å®Œæˆå­¸åˆ†
            data.meta.total_completed = 0;
            data.categories.forEach(c => c.completed = 0);
            data.majorRequiredDetail.forEach(d => d.completed = 0);

            // 2. æ ¹æ“š completedCourses é‡æ–°è¨ˆç®—
            data.completedCourses.forEach(course => {
                const credits = parseFloat(course.credits);
                data.meta.total_completed += credits;
                
                const type = course.type;
                const subtype = course.subtype;

                // --- è™•ç†å››å¤§é¡åˆ¥ (categories) ---
                if (type === 'å¿…ä¿®') {
                    // æª¢æŸ¥æ˜¯å¦å±¬æ–¼ç³»ä¸Šå¿…ä¿® I ( majorRequiredDetail)
                    const detailName = data.requiredMapping[subtype];
                    if (detailName) {
                        data.categories.find(c => c.name === "ç³»ä¸Šå¿…ä¿®").completed += credits;
                        
                        // æ›´æ–° majorRequiredDetail
                        const detailItem = data.majorRequiredDetail.find(d => d.sub === detailName);
                        if (detailItem) {
                            detailItem.completed += credits;
                        }
                    }
                } else if (type === 'é€šè­˜' && data.generalEducationSubtypes.includes(subtype)) {
                    // è™•ç†å…±åŒæ ¸å¿ƒ II
                    data.categories.find(c => c.name === "å…±åŒæ ¸å¿ƒ").completed += credits;
                } else if (type === 'é¸ä¿®') {
                    if (subtype === 'å°ˆé¸') {
                        // è™•ç†ç³»ä¸Šå°ˆé¸ III
                        data.categories.find(c => c.name === "ç³»ä¸Šå°ˆé¸").completed += credits;
                    } else if (subtype === 'å…¶ä»–é¸ä¿®') {
                        // è™•ç†å…¶ä»–é¸ä¿® IV
                        data.categories.find(c => c.name === "å…¶ä»–é¸ä¿®").completed += credits;
                    }
                }
            });

            // 3. æ›´æ–° majorRequiredDetail çš„å‰©é¤˜å­¸åˆ†
            data.majorRequiredDetail.forEach(d => {
                d.remaining = Math.max(0, d.required - d.completed);
                // æ ¹æ“šå‰©é¤˜å­¸åˆ†æ›´æ–° todo ç‹€æ…‹ (ç°¡æ˜“é‚è¼¯)
                if (d.remaining === 0) {
                    d.todo = "âœ… å·²å®Œæˆ";
                } else if (d.completed > 0 && d.remaining < d.required) {
                    // å‡è¨­å°šç¼ºèª²ç¨‹æ˜¯å›ºå®šçš„ï¼Œåªæœ‰ç•¶å­¸åˆ†è£œè¶³æ™‚æ‰æ¨™è¨˜ç‚ºå®Œæˆ
                    // é€™è£¡ä¿æŒåŸæœ‰çš„å¾…è¾¦èª²ç¨‹åç¨±
                }
            });

            // 4. æ›´æ–°ç¸½è¨ˆ
            data.meta.total_remaining = data.meta.total_required - data.meta.total_completed;

            renderApp();
        };

        // --- æ¸²æŸ“å‡½æ•¸ ---
        const renderApp = () => {
            // 1. ç¸½é«”æ‘˜è¦ & Header
            document.getElementById('version').textContent = data.meta.version;
            document.getElementById('generated-date').textContent = data.meta.generated_on;
            document.getElementById('total-required').textContent = data.meta.total_required;
            document.getElementById('total-completed').textContent = data.meta.total_completed;
            document.getElementById('total-remaining').textContent = data.meta.total_remaining;

            // 2. ç•¢æ¥­è¦æ±‚ç¸½è¦½è¡¨æ ¼
            const summaryBody = document.getElementById('summary-body');
            summaryBody.innerHTML = '';
            
            let totalCompRatio = data.meta.total_completed / data.meta.total_required;

            data.categories.forEach(c => {
                let req = c.required;
                let completed = c.completed;
                let reqForCalc = typeof req === 'string' ? parseFloat(req.replace('â‰¥', '')) : req;

                let remaining = reqForCalc - completed;
                let compRatio = completed / reqForCalc;
                let done = pct(completed, reqForCalc);
                let statusHTML = getStatusBadge(compRatio);
                
                const remainingText = typeof req === 'string' ? `â‰¥${Math.max(0, remaining)}` : Math.max(0, remaining);

                // Append the row
                summaryBody.innerHTML += `
                    <tr class="hover:bg-gray-100">
                        <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${c.name}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-center">${req}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-center font-bold text-green-600">${completed}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-center text-red-600">${remainingText}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-center">${done}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-center">${statusHTML}</td>
                    </tr>
                `;
            });

            // Add Total Row
            summaryBody.innerHTML += `
                <tr class="bg-blue-50 border-t-2 border-blue-200">
                    <td class="px-3 py-2 whitespace-nowrap text-sm font-extrabold text-blue-800">ç¸½è¨ˆ</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-center font-bold">${data.meta.total_required}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-center font-extrabold text-green-700">${data.meta.total_completed}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-center font-bold text-red-700">${data.meta.total_remaining}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-center font-extrabold">${pct(data.meta.total_completed, data.meta.total_required)}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-center">${getStatusBadge(totalCompRatio)}</td>
                </tr>
            `;

            // 3. ç³»ä¸Šå¿…ä¿®è©³æƒ… & é€²åº¦æ¢
            const majorCategory = data.categories.find(c => c.name === "ç³»ä¸Šå¿…ä¿®");
            const majorPct = (majorCategory.completed / majorCategory.required) * 100;
            document.getElementById('major-progress').innerHTML = getProgressBarStyle(majorPct, majorCategory.completed, majorCategory.required);

            const detailBody = document.getElementById('detail-body');
            detailBody.innerHTML = '';
            data.majorRequiredDetail.forEach(d => {
                const todoClass = d.remaining > 0 ? 'text-red-500 font-medium' : 'text-green-600';
                const todoText = d.remaining === 0 ? "âœ… å·²å®Œæˆ" : d.todo;
                
                detailBody.innerHTML += `
                    <tr class="hover:bg-gray-100">
                        <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${d.sub}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-center">${d.required}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-center">${d.completed}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-center">${d.remaining}</td>
                        <td class="px-3 py-2 whitespace-normal text-sm ${todoClass}">${todoText}</td>
                    </tr>
                `;
            });

            // 4. å…¶ä»–é¡åˆ¥ç°¡è¿°çš„å³æ™‚æ›´æ–°
            document.getElementById('core-completed').textContent = data.categories.find(c => c.name === "å…±åŒæ ¸å¿ƒ").completed;
            document.getElementById('core-remaining').textContent = `è‡³å°‘ ${Math.max(0, 18 - data.categories.find(c => c.name === "å…±åŒæ ¸å¿ƒ").completed)}`;
            
            document.getElementById('elective-special-completed').textContent = data.categories.find(c => c.name === "ç³»ä¸Šå°ˆé¸").completed;
            document.getElementById('elective-special-remaining').textContent = Math.max(0, 9 - data.categories.find(c => c.name === "ç³»ä¸Šå°ˆé¸").completed);

            document.getElementById('elective-other-completed').textContent = data.categories.find(c => c.name === "å…¶ä»–é¸ä¿®").completed;
            document.getElementById('elective-other-remaining').textContent = Math.max(0, 26 - data.categories.find(c => c.name === "å…¶ä»–é¸ä¿®").completed);

            // 5. ä¿®èª²å»ºè­°
            const adviceList = document.getElementById('advice-list');
            adviceList.innerHTML = data.advice.map(item => `<li>${item}</li>`).join('');
        };


        // --- è¡¨å–®é€£å‹•é‚è¼¯ ---
        document.addEventListener('DOMContentLoaded', () => {
            const courseTypeSelect = document.getElementById('course-type');
            const courseSubtypeSelect = document.getElementById('course-subtype');
            const form = document.getElementById('add-course-form');
            const message = document.getElementById('message');

            const requiredOptions = [
                "åŸºç¤èª²ç¨‹", "èªè¨€å­¸", "æ–·ä»£å²", "ç¬¬äºŒå¤–èª", 
                "æ–‡é¡èª²ç¨‹-è©©", "æ–‡é¡èª²ç¨‹-å°èªª", "æ–‡é¡èª²ç¨‹-æˆ²åŠ‡", "æ–‡é¡èª²ç¨‹-å…¶ä»–", 
                "å…¶ä»–" // ä¾‹å¦‚ï¼šè¨ˆç®—æ©Ÿæ¦‚è«–
            ];

            const electiveOptions = [
                "å°ˆé¸", "å…¶ä»–é¸ä¿®"
            ];

            const updateSubtypeOptions = () => {
                courseSubtypeSelect.innerHTML = '<option value="">-- è«‹é¸æ“‡å­é¡åˆ¥ --</option>';
                const selectedType = courseTypeSelect.value;
                let options = [];

                if (selectedType === 'é€šè­˜') {
                    options = data.generalEducationSubtypes;
                } else if (selectedType === 'å¿…ä¿®') {
                    options = requiredOptions;
                } else if (selectedType === 'é¸ä¿®') {
                    options = electiveOptions;
                }

                options.forEach(optionText => {
                    const option = document.createElement('option');
                    option.value = optionText;
                    option.textContent = optionText;
                    courseSubtypeSelect.appendChild(option);
                });
            };

            courseTypeSelect.addEventListener('change', updateSubtypeOptions);

            // --- è¡¨å–®æäº¤è™•ç† ---
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                message.textContent = '';

                const newCourse = {
                    type: courseTypeSelect.value,
                    subtype: courseSubtypeSelect.value,
                    name: document.getElementById('course-name').value.trim(),
                    credits: parseFloat(document.getElementById('course-credits').value),
                };

                if (isNaN(newCourse.credits) || newCourse.credits <= 0) {
                    message.textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„å­¸åˆ†æ•¸ (å¿…é ˆå¤§æ–¼ 0)ã€‚';
                    return;
                }
                if (!newCourse.type || !newCourse.subtype) {
                    message.textContent = 'è«‹å®Œæ•´é¸æ“‡èª²ç¨‹é¡åˆ¥å’Œå­é¡åˆ¥ã€‚';
                    return;
                }

                recalculateData(newCourse);
                
                // æˆåŠŸè¨Šæ¯å’Œè¡¨å–®é‡ç½®
                message.textContent = `âœ… èª²ç¨‹ã€Œ${newCourse.name}ã€(${newCourse.credits}å­¸åˆ†) å·²æˆåŠŸæ–°å¢ä¸¦æ›´æ–°å ±å‘Šï¼`;
                form.reset();
                courseSubtypeSelect.innerHTML = '<option value="">-- è«‹å…ˆé¸ä¸Šå±¤é¡åˆ¥ --</option>'; // é‡ç½®é€£å‹•é¸å–®
            });

            // åˆå§‹æ¸²æŸ“
            recalculateData();
        });
    </script>
</body>
</html>
